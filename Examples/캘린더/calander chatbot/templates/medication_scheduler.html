<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’Š ì•½ë¬¼ ë³µìš© ì¼ì • ìë™ ìƒì„± ì—ì´ì „íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .input-section, .result-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        .medication-input {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            resize: vertical;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        .medication-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .duration-input {
            width: 100px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            text-align: center;
        }
        
        .duration-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-area {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        
        .medication-list {
            margin-top: 20px;
        }
        
        .medication-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .medication-item h4 {
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .examples {
            background: #e7f3ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .examples h4 {
            color: #0066cc;
            margin-bottom: 10px;
        }
        
        .example-text {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        
        .example-text:hover {
            background-color: #d0e7ff;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        
        .loading .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’Š ì•½ë¬¼ ë³µìš© ì¼ì • ìë™ ìƒì„± ì—ì´ì „íŠ¸</h1>
            <p>ì•½ë¬¼ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ êµ¬ê¸€ ìº˜ë¦°ë”ì— ë³µìš© ì¼ì •ì„ ì¶”ê°€í•´ë“œë¦½ë‹ˆë‹¤</p>
        </div>
        
        <div class="main-content">
            <!-- ì…ë ¥ ì„¹ì…˜ -->
            <div class="input-section">
                <div class="section-title">
                    ğŸ“ ì•½ë¬¼ ì •ë³´ ì…ë ¥
                </div>
                
                <div class="examples">
                    <h4>ğŸ’¡ ì…ë ¥ ì˜ˆì‹œ (í´ë¦­í•˜ë©´ ìë™ ì…ë ¥)</h4>
                    <div class="example-text" onclick="setExample('íƒ€ì´ë ˆë†€ 500mg í•˜ë£¨ 3íšŒ ë³µìš©, ì•„ì¹¨ ì ì‹¬ ì €ë… ì‹í›„')">
                        â€¢ íƒ€ì´ë ˆë†€ 500mg í•˜ë£¨ 3íšŒ ë³µìš©, ì•„ì¹¨ ì ì‹¬ ì €ë… ì‹í›„
                    </div>
                    <div class="example-text" onclick="setExample('ì˜¤ë©”í”„ë¼ì¡¸ 20mg ì•„ì¹¨ ê³µë³µì— ë³µìš©\nì•”ë¸Œë¡ì†” 30mg í•˜ë£¨ 2íšŒ ì•„ì¹¨ ì €ë… ë³µìš©')">
                        â€¢ ì˜¤ë©”í”„ë¼ì¡¸ 20mg ì•„ì¹¨ ê³µë³µì— ë³µìš©<br>â€¢ ì•”ë¸Œë¡ì†” 30mg í•˜ë£¨ 2íšŒ ì•„ì¹¨ ì €ë… ë³µìš©
                    </div>
                    <div class="example-text" onclick="setExample('í™˜ìëª…: í™ê¸¸ë™\nì²˜ë°©:\n1. íƒ€ì´ë ˆë†€ 500mg - í•˜ë£¨ 3íšŒ, ì‹í›„ ë³µìš©\n2. ê°€ìŠ¤í„° 20mg - í•˜ë£¨ 1íšŒ, ì•„ì¹¨ ì‹ì „ ë³µìš©\në³µìš©ê¸°ê°„: 7ì¼')">
                        â€¢ ì²˜ë°©ì „ í˜•íƒœì˜ í…ìŠ¤íŠ¸
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="medicationText">ì•½ë¬¼ ì •ë³´ (ì†Œê²¬ì„œ, ì²˜ë°©ì „, ì•½êµ­ ì„¤ëª…ì„œ ë“±)</label>
                    <textarea 
                        id="medicationText" 
                        class="medication-input"
                        placeholder="ì•½ë¬¼ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;íƒ€ì´ë ˆë†€ 500mg í•˜ë£¨ 3íšŒ ì•„ì¹¨ ì ì‹¬ ì €ë… ë³µìš©&#10;ì˜¤ë©”í”„ë¼ì¡¸ 20mg ì•„ì¹¨ ì‹ì „ ë³µìš©&#10;&#10;ì—¬ëŸ¬ ì•½ë¬¼ì„ í•œ ë²ˆì— ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                    ></textarea>
                </div>
                
                <div class="input-group">
                    <label for="durationDays">ë³µìš© ê¸°ê°„ (ì¼ìˆ˜)</label>
                    <input type="number" id="durationDays" class="duration-input" value="30" min="1" max="365">
                    <small style="color: #666; margin-left: 10px;">ê¸°ë³¸ê°’: 30ì¼</small>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="processMedication()" id="processBtn">
                        ğŸš€ ì¼ì • ìƒì„±í•˜ê¸°
                    </button>
                    <button class="btn btn-secondary" onclick="getEvents()">
                        ğŸ“‹ ì¼ì • ì¡°íšŒ
                    </button>
                    <button class="btn btn-danger" onclick="deleteAllEvents()">
                        ğŸ—‘ï¸ ëª¨ë“  ì•½ë¬¼ ì¼ì • ì‚­ì œ
                    </button>
                </div>
            </div>
            
            <!-- ê²°ê³¼ ì„¹ì…˜ -->
            <div class="result-section">
                <div class="section-title">
                    ğŸ“Š ì²˜ë¦¬ ê²°ê³¼
                </div>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>ì•½ë¬¼ ì •ë³´ë¥¼ ë¶„ì„í•˜ê³  ì¼ì •ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>
                
                <div class="result-area" id="resultArea">
                    ğŸ’Š ì•½ë¬¼ ë³µìš© ì¼ì • ìë™ ìƒì„± ì—ì´ì „íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!
                    
ğŸ“‹ ì‚¬ìš© ë°©ë²•:
1. ì™¼ìª½ì— ì•½ë¬¼ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”
2. ë³µìš© ê¸°ê°„ì„ ì„¤ì •í•˜ì„¸ìš” (ê¸°ë³¸ 30ì¼)
3. "ì¼ì • ìƒì„±í•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
4. êµ¬ê¸€ ìº˜ë¦°ë”ì— ìë™ìœ¼ë¡œ ë³µìš© ì¼ì •ì´ ì¶”ê°€ë©ë‹ˆë‹¤

âœ¨ ê¸°ëŠ¥:
â€¢ ìì—°ì–´ ì²˜ë¦¬ë¡œ ì•½ë¬¼ ì •ë³´ ìë™ ë¶„ì„
â€¢ ë³µìš© ì‹œê°„ ìë™ ê³„ì‚° (ì•„ì¹¨/ì ì‹¬/ì €ë…/ì‹ì „/ì‹í›„)
â€¢ ë°˜ë³µ ì¼ì • ìë™ ìƒì„±
â€¢ ë³µìš© ì‹œê°„ 10ë¶„ ì „ + ì •ì‹œ ì•Œë¦¼ ì„¤ì •
â€¢ í•œêµ­ ì‹œê°„ëŒ€ ì§€ì›

ğŸ”§ ì§€ì›í•˜ëŠ” ì…ë ¥ í˜•ì‹:
â€¢ "ì•½ë¬¼ëª… ìš©ëŸ‰ í•˜ë£¨ NíšŒ ë³µìš©"
â€¢ "ì•½ë¬¼ëª… ë³µìš©ì‹œê°„ (ì•„ì¹¨/ì ì‹¬/ì €ë…/ì‹ì „/ì‹í›„)"
â€¢ ì²˜ë°©ì „ì´ë‚˜ ì•½êµ­ ì„¤ëª…ì„œ í…ìŠ¤íŠ¸
â€¢ ì—¬ëŸ¬ ì•½ë¬¼ì„ í•œ ë²ˆì— ì…ë ¥ ê°€ëŠ¥

ì¤€ë¹„ê°€ ë˜ì…¨ìœ¼ë©´ ì•½ë¬¼ ì •ë³´ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”!
                </div>
                
                <div class="medication-list" id="medicationList"></div>
            </div>
        </div>
    </div>

    <script>
        function setExample(text) {
            document.getElementById('medicationText').value = text;
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultArea').style.display = 'none';
            document.getElementById('processBtn').disabled = true;
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('processBtn').disabled = false;
        }
        
        async function processMedication() {
            const patientText = document.getElementById('medicationText').value.trim();
            const durationDays = parseInt(document.getElementById('durationDays').value) || 30;
            
            if (!patientText) {
                alert('ì•½ë¬¼ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch('/process_medication', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        patient_text: patientText,
                        duration_days: durationDays
                    })
                });
                
                const data = await response.json();
                hideLoading();
                
                if (data.success) {
                    // ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ
                    document.getElementById('resultArea').textContent = data.messages.join('\n');
                    
                    // ì•½ë¬¼ ì •ë³´ ì¹´ë“œ í‘œì‹œ
                    displayMedicationCards(data.medications);
                    
                    // ì„±ê³µ ì•Œë¦¼
                    alert(`âœ… ì„±ê³µ! ${data.created_events.length}ê°œì˜ ë³µìš© ì¼ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    document.getElementById('resultArea').textContent = data.messages ? data.messages.join('\n') : data.error;
                }
                
            } catch (error) {
                hideLoading();
                document.getElementById('resultArea').textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }
        
        function displayMedicationCards(medications) {
            const listContainer = document.getElementById('medicationList');
            listContainer.innerHTML = '';
            
            if (medications && medications.length > 0) {
                medications.forEach((med, index) => {
                    const card = document.createElement('div');
                    card.className = 'medication-item';
                    card.innerHTML = `
                        <h4>ğŸ’Š ${med.name}</h4>
                        <p><strong>ë³µìš© íšŸìˆ˜:</strong> í•˜ë£¨ ${med.frequency}íšŒ</p>
                        <p><strong>ë³µìš© ì‹œê°„:</strong> ${med.times.join(', ')}</p>
                    `;
                    listContainer.appendChild(card);
                });
            }
        }
        
        async function getEvents() {
            showLoading();
            
            try {
                const response = await fetch('/get_events');
                const data = await response.json();
                hideLoading();
                
                if (data.success) {
                    if (data.events.length === 0) {
                        document.getElementById('resultArea').textContent = 'ğŸ’Š í˜„ì¬ ë“±ë¡ëœ ì•½ë¬¼ ë³µìš© ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.';
                    } else {
                        let resultText = `ğŸ“‹ ì•½ë¬¼ ë³µìš© ì¼ì • (ì´ ${data.events.length}ê°œ)\n\n`;
                        data.events.forEach((event, index) => {
                            resultText += `${index + 1}. ${event.title}\n`;
                            resultText += `   â° ${event.start_time}\n\n`;
                        });
                        document.getElementById('resultArea').textContent = resultText;
                    }
                } else {
                    document.getElementById('resultArea').textContent = `âŒ ì¼ì • ì¡°íšŒ ì˜¤ë¥˜: ${data.error}`;
                }
                
            } catch (error) {
                hideLoading();
                document.getElementById('resultArea').textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }
        
        async function deleteAllEvents() {
            if (!confirm('âš ï¸ ëª¨ë“  ì•½ë¬¼ ë³µìš© ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch('/delete_events', {
                    method: 'POST'
                });
                const data = await response.json();
                hideLoading();
                
                if (data.success) {
                    document.getElementById('resultArea').textContent = `âœ… ${data.deleted_count}ê°œì˜ ì•½ë¬¼ ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    document.getElementById('medicationList').innerHTML = '';
                } else {
                    document.getElementById('resultArea').textContent = `âŒ ì‚­ì œ ì˜¤ë¥˜: ${data.error}`;
                }
                
            } catch (error) {
                hideLoading();
                document.getElementById('resultArea').textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }
    </script>
</body>
</html>
